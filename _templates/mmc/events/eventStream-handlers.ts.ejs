---
to: libs/backend/<%=contextFileName %>-core/src/domain/<%=eventStreamFileName%>.ts
inject: true
after: //start <%=CommandName%>
before: //end <%=CommandName%>
after_not_found: when
---
//start <%=CommandName%>
<%if (isStartOfEventStream) {%>
  public <%=commandName%>(<%=eventStreamIdentifier%>: string, command: <%=CommandName%><%if (serviceName) {-%>, <%= serviceParameterType%><%}%> ) {
<%events[eventIndex].scenarios.map((scenario) => {-%>
<%if (serviceName) {-%>const <%=serviceResultName%> = <%=serviceCallingCode%><%}%>
<%if(scenario.rule) {%>if (<%=scenario.rule%>)<%}-%>
      this.apply(<%=EventName%>, { ...command, <%=eventStreamIdentifier%> <%if (serviceName) {-%>, <%=serviceResultName%><%}%> });
<%})%>
  }<%} else {-%>
  public <%=commandName%>(command: <%=CommandName%><%if (serviceName) {-%>, <%= serviceParameterType%><%}%>) {
  <%events[eventIndex].scenarios.map((scenario) => {-%>
<%if (serviceName) {-%>const <%=serviceResultName%> = <%=serviceCallingCode%><%}%>
  <%if(scenario.rule) {%>if (<%=scenario.rule%>)<%}%>
  this.apply(<%=EventName%>, { ...command <%if (serviceName) {-%>, <%=serviceResultName%><%}%> });
  <%})%>
  }
<%}%>

  @eventSourcingHandler({ name: '<%=EventName%>' })
  on<%=EventName%>(event: <%=EventName%>) {
<%events[eventIndex].event.facts.map( (fact) => {%>      this.<%=h.changeCase.camel(fact.fact.name)%> = event.<%=h.changeCase.camel(fact.fact.name)%>;
<% }) -%>
  }
  //end <%=CommandName%>
